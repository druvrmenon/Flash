/* ══════════════ 8 THEMES ══════════════ */
[data-theme="aurora"]{--bg:#07091a;--surf:#0d1230;--panel:#101535;--ink:#dde4ff;--ink-2:#7b8cc4;--ink-3:#353f6b;--ac:#7c6ffa;--ac-s:#1a1550;--ac2:#22d3ee;--ac3:#34d399;--grad:linear-gradient(135deg,#4f3df7,#7c6ffa 50%,#22d3ee);--cf:linear-gradient(145deg,#1a1550,#0d0a38);--cb:#101535;--nav:rgba(7,9,26,.97);--sh:rgba(124,111,250,.3);--br:rgba(124,111,250,.18)}
[data-theme="parchment"]{--bg:#fdf8f0;--surf:#f5ede0;--panel:#fff;--ink:#1c120a;--ink-2:#78624a;--ink-3:#c4a882;--ac:#9a5c1a;--ac-s:#fef3e2;--ac2:#2563eb;--ac3:#16a34a;--grad:linear-gradient(135deg,#9a5c1a,#d97706);--cf:linear-gradient(145deg,#1c120a,#2d1e10);--cb:#fff;--nav:rgba(253,248,240,.97);--sh:rgba(154,92,26,.12);--br:rgba(154,92,26,.15)}
[data-theme="sakura"]{--bg:#fff4f7;--surf:#ffe6ee;--panel:#fff;--ink:#2d0513;--ink-2:#9e2d50;--ink-3:#f4a6be;--ac:#db2777;--ac-s:#fce7f3;--ac2:#7c3aed;--ac3:#059669;--grad:linear-gradient(135deg,#db2777,#9d174d);--cf:linear-gradient(145deg,#2d0513,#560b28);--cb:#fff;--nav:rgba(255,244,247,.97);--sh:rgba(219,39,119,.15);--br:rgba(219,39,119,.15)}
[data-theme="ocean"]{--bg:#f0f8ff;--surf:#dbeeff;--panel:#fff;--ink:#07203d;--ink-2:#1d5c8f;--ink-3:#7ec8e3;--ac:#0369a1;--ac-s:#e0f2fe;--ac2:#0891b2;--ac3:#059669;--grad:linear-gradient(135deg,#0369a1,#0ea5e9);--cf:linear-gradient(145deg,#07203d,#0c3460);--cb:#fff;--nav:rgba(240,248,255,.97);--sh:rgba(3,105,161,.12);--br:rgba(3,105,161,.15)}
[data-theme="forest"]{--bg:#f2faf2;--surf:#dcf2dc;--panel:#fff;--ink:#0d2410;--ink-2:#2d6b35;--ink-3:#82c88a;--ac:#166534;--ac-s:#dcfce7;--ac2:#15803d;--ac3:#65a30d;--grad:linear-gradient(135deg,#14532d,#166534);--cf:linear-gradient(145deg,#0d2410,#1a3d18);--cb:#fff;--nav:rgba(242,250,242,.97);--sh:rgba(22,101,52,.12);--br:rgba(22,101,52,.15)}
[data-theme="ember"]{--bg:#fff8f0;--surf:#fde8cc;--panel:#fff;--ink:#3d1000;--ink-2:#9a3200;--ink-3:#f5a570;--ac:#c2410c;--ac-s:#ffedd5;--ac2:#b91c1c;--ac3:#ca8a04;--grad:linear-gradient(135deg,#c2410c,#ea580c);--cf:linear-gradient(145deg,#3d1000,#7c2010);--cb:#fff;--nav:rgba(255,248,240,.97);--sh:rgba(194,65,12,.15);--br:rgba(194,65,12,.15)}
[data-theme="neon"]{--bg:#040508;--surf:#080c18;--panel:#0d1224;--ink:#ede9ff;--ink-2:#a78bfa;--ink-3:#4c1d95;--ac:#c026d3;--ac-s:#1a0533;--ac2:#06b6d4;--ac3:#10b981;--grad:linear-gradient(135deg,#a855f7,#c026d3,#ec4899);--cf:linear-gradient(145deg,#1a0533,#0c1040);--cb:#0d1224;--nav:rgba(4,5,8,.98);--sh:rgba(192,38,211,.3);--br:rgba(192,38,211,.2)}
[data-theme="slate"]{--bg:#f8fafc;--surf:#f1f5f9;--panel:#fff;--ink:#0f172a;--ink-2:#475569;--ink-3:#94a3b8;--ac:#4f46e5;--ac-s:#eff6ff;--ac2:#0891b2;--ac3:#10b981;--grad:linear-gradient(135deg,#4f46e5,#7c3aed);--cf:linear-gradient(145deg,#0f172a,#1e293b);--cb:#fff;--nav:rgba(248,250,252,.97);--sh:rgba(79,70,229,.1);--br:rgba(79,70,229,.12)}

/* ══════════════ BASE ══════════════ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{height:100%;scroll-behavior:smooth}
body{background:var(--bg);font-family:'Sora',sans-serif;color:var(--ink);min-height:100vh;overflow-x:hidden;-webkit-tap-highlight-color:transparent;transition:background .35s,color .35s}
body::before{content:'';position:fixed;inset:0;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='4'/%3E%3C/filter%3E%3Crect width='400' height='400' filter='url(%23n)' opacity='.03'/%3E%3C/svg%3E");pointer-events:none;z-index:0}
.screen{display:none;min-height:100vh;position:relative;z-index:1}
.screen.active{display:flex;flex-direction:column}

/* ══════════════ NAV ══════════════ */
.nav{position:sticky;top:0;z-index:60;background:var(--nav);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--br);padding:0 clamp(1rem,4vw,2rem);height:60px;display:flex;align-items:center;justify-content:space-between;gap:.5rem;flex-shrink:0}
.nav-brand{font-family:'Fraunces',serif;font-size:1.45rem;font-weight:700;letter-spacing:-.03em;display:flex;align-items:center;gap:.5rem;flex-shrink:0;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.nav-streak{display:none;align-items:center;gap:.3rem;font-family:'JetBrains Mono',monospace;font-size:.72rem;font-weight:500;color:var(--ac);background:var(--ac-s);padding:.2rem .55rem;border-radius:8px;border:1px solid var(--br)}
.nav-streak.show{display:flex}
.nav-actions{display:flex;gap:.35rem;align-items:center;flex-wrap:wrap}
.nb{font-family:'JetBrains Mono',monospace;font-size:.6rem;letter-spacing:.04em;border:1px solid var(--br);background:transparent;color:var(--ink-2);border-radius:9px;padding:.4rem .75rem;cursor:pointer;transition:all .18s;white-space:nowrap}
.nb:hover{border-color:var(--ac);color:var(--ac);background:var(--ac-s)}
.nb.primary{background:var(--grad);color:#fff;border-color:transparent}
.nb.primary:hover{opacity:.85;transform:translateY(-1px)}
.offline-dot{display:none;width:7px;height:7px;border-radius:50%;background:#f87171;flex-shrink:0}
.offline-dot.show{display:block}

/* ══════════════ SWATCHES ══════════════ */
.swatches{display:flex;gap:.35rem;align-items:center}
.sw{width:20px;height:20px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all .2s;flex-shrink:0}
.sw.active{border-color:var(--ink);transform:scale(1.2)}
.sw:hover{transform:scale(1.25)}

/* ══════════════ EXAM BANNER ══════════════ */
.exam-banner{background:var(--grad);color:#fff;padding:.5rem 1.5rem;display:none;align-items:center;justify-content:center;gap:1rem;font-size:.75rem;font-family:'JetBrains Mono',monospace;flex-wrap:wrap;flex-shrink:0;letter-spacing:.03em}
.exam-banner.show{display:flex}

/* ══════════════ API KEY SCREEN ══════════════ */
#screen-apikey{align-items:center;justify-content:center;padding:2rem;min-height:100vh}
.api-card{background:var(--panel);border:1px solid var(--br);border-radius:24px;padding:2.5rem;box-shadow:0 24px 80px var(--sh);max-width:460px;width:100%;display:flex;flex-direction:column;gap:1.3rem;animation:fadeUp .6s ease both}
.api-card .logo{font-family:'Fraunces',serif;font-size:2.2rem;font-weight:700;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.api-card h2{font-family:'Fraunces',serif;font-size:1.5rem;font-weight:500;color:var(--ink)}
.api-card p{color:var(--ink-2);font-size:.88rem;line-height:1.7}
.api-card a{color:var(--ac2);text-decoration:none;font-weight:600}
.lbl{font-size:.65rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--ink-2);display:block;margin-bottom:.4rem}
.inp{border:1.5px solid var(--br);border-radius:12px;padding:.8rem 1rem;font-family:'JetBrains Mono',monospace;font-size:.82rem;outline:none;transition:border-color .2s,box-shadow .2s;background:var(--surf);width:100%;color:var(--ink)}
.inp:focus{border-color:var(--ac);box-shadow:0 0 0 3px var(--ac-s)}
.api-note{font-size:.72rem;color:var(--ink-3);line-height:1.6;border-top:1px solid var(--br);padding-top:1rem}
.btn-full{width:100%;padding:1.05rem;background:var(--grad);color:#fff;border:none;border-radius:12px;font-family:'Fraunces',serif;font-size:1.05rem;font-weight:500;cursor:pointer;transition:all .2s;letter-spacing:-.01em}
.btn-full:hover{opacity:.88;transform:translateY(-1px);box-shadow:0 8px 28px var(--sh)}
.btn-full:disabled{opacity:.35;cursor:not-allowed;transform:none}

/* ══════════════ UPLOAD SCREEN ══════════════ */
.upload-grid{flex:1;display:grid;grid-template-columns:1fr 1fr;gap:2rem;padding:clamp(1.5rem,4vw,2.5rem) clamp(1rem,4vw,2rem);max-width:1100px;margin:0 auto;width:100%;align-items:start}
@media(max-width:720px){.upload-grid{grid-template-columns:1fr}}
.hero h1{font-family:'Fraunces',serif;font-size:clamp(2rem,5vw,3rem);font-weight:700;line-height:1.1;letter-spacing:-.035em;margin-bottom:.9rem}
.hero h1 span{background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{color:var(--ink-2);font-size:.93rem;line-height:1.75;font-weight:300;margin-bottom:1.8rem;max-width:430px}
.feat-chips{display:flex;flex-wrap:wrap;gap:.4rem}
.fc{font-size:.72rem;background:var(--surf);border:1px solid var(--br);border-radius:100px;padding:.28rem .75rem;color:var(--ink-2);font-weight:500}
/* Panel */
.panel{background:var(--panel);border:1px solid var(--br);border-radius:22px;padding:1.6rem;box-shadow:0 8px 40px var(--sh);display:flex;flex-direction:column;gap:1.1rem}
/* Tabs */
.tabs{display:flex;gap:.3rem;background:var(--surf);border-radius:11px;padding:.25rem}
.tab{flex:1;border:none;background:transparent;border-radius:8px;padding:.48rem;font-family:'JetBrains Mono',monospace;font-size:.65rem;letter-spacing:.04em;color:var(--ink-2);cursor:pointer;transition:all .18s}
.tab.active{background:var(--panel);color:var(--ac);font-weight:500;box-shadow:0 2px 8px var(--sh)}
.tabp{display:none;flex-direction:column;gap:.8rem}
.tabp.active{display:flex}
/* Drop zone */
.dz{border:2px dashed var(--br);border-radius:14px;padding:2rem 1.5rem;display:flex;flex-direction:column;align-items:center;text-align:center;cursor:pointer;position:relative;transition:all .22s;gap:.5rem}
.dz:hover,.dz.over{border-color:var(--ac);background:var(--ac-s)}
.dz input{position:absolute;inset:0;opacity:0;cursor:pointer}
.dz-icon{width:48px;height:48px;border-radius:13px;background:var(--ac-s);border:1px solid var(--br);display:flex;align-items:center;justify-content:center;font-size:1.4rem}
.dz-title{font-family:'Fraunces',serif;font-size:.95rem;font-weight:500;color:var(--ink)}
.dz-sub{font-size:.74rem;color:var(--ink-2)}
.fpill{display:none;align-items:center;gap:.45rem;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;padding:.45rem .7rem;font-family:'JetBrains Mono',monospace;font-size:.68rem;color:#166534;width:100%}
.fpill.show{display:flex}
.yt-inp{border:1.5px solid var(--br);border-radius:12px;padding:.75rem 1rem;font-size:.88rem;outline:none;transition:border-color .2s;background:var(--surf);color:var(--ink);width:100%}
.yt-inp:focus{border-color:#ef4444}
.yt-note{font-size:.7rem;color:var(--ink-2);background:var(--surf);border-radius:10px;padding:.6rem .8rem;line-height:1.6;border:1px solid var(--br)}
/* Count chips */
.cnt-row{display:flex;gap:.4rem;flex-wrap:wrap}
.cc{border:1.5px solid var(--br);background:var(--surf);border-radius:9px;padding:.48rem .85rem;font-family:'Fraunces',serif;font-size:.95rem;font-weight:500;cursor:pointer;transition:all .15s;color:var(--ink-2);min-width:44px;text-align:center}
.cc:hover{border-color:var(--ac);color:var(--ac)}
.cc.active{border-color:var(--ac);background:var(--grad);color:#fff;border-color:transparent}
.cust-row{display:flex;align-items:center;gap:.5rem;margin-top:.3rem}
.cust-row label{font-size:.75rem;color:var(--ink-2)}
.cust-row input{border:1.5px solid var(--br);border-radius:8px;padding:.38rem .65rem;font-family:'JetBrains Mono',monospace;font-size:.82rem;width:75px;outline:none;transition:border-color .2s;background:var(--surf);color:var(--ink)}
.cust-row input:focus{border-color:var(--ac)}
select.sel{border:1.5px solid var(--br);border-radius:12px;padding:.6rem 1rem;font-family:'JetBrains Mono',monospace;font-size:.78rem;outline:none;background:var(--surf);color:var(--ink);width:100%;cursor:pointer;transition:border-color .2s;-webkit-appearance:none}
select.sel:focus{border-color:var(--ac)}
.date-row{display:flex;align-items:center;gap:.5rem}
.date-row input[type="date"]{flex:1;border:1.5px solid var(--br);border-radius:12px;padding:.6rem 1rem;font-family:'JetBrains Mono',monospace;font-size:.78rem;outline:none;background:var(--surf);color:var(--ink);transition:border-color .2s}
.date-row input:focus{border-color:var(--ac)}
.date-row button{border:none;background:var(--ac-s);color:var(--ac);padding:.6rem .9rem;border-radius:12px;font-size:.7rem;font-family:'JetBrains Mono',monospace;cursor:pointer;font-weight:600;white-space:nowrap;border:1px solid var(--br);transition:all .18s}
.date-row button:hover{background:var(--ac);color:#fff;border-color:var(--ac)}
#cd-msg{font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--ac);min-height:1.2em;margin-top:.3rem}
/* Library */
.lib-sec{padding:0 clamp(1rem,4vw,2rem) clamp(2rem,4vw,3rem);max-width:1100px;margin:0 auto;width:100%}
.lib-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;flex-wrap:wrap;gap:.5rem}
.lib-ttl{font-family:'Fraunces',serif;font-size:1.15rem;font-weight:500}
.merge-controls{display:flex;gap:.5rem;align-items:center}
.lib-empty{background:var(--panel);border-radius:14px;padding:2.5rem;text-align:center;border:1.5px dashed var(--br);color:var(--ink-2);font-size:.88rem}
.lib-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(185px,1fr));gap:.85rem}
.lc{background:var(--panel);border-radius:14px;padding:1.1rem;box-shadow:0 2px 12px var(--sh);cursor:pointer;border:1.5px solid transparent;transition:all .2s;position:relative}
.lc:hover{border-color:var(--ac);transform:translateY(-2px);box-shadow:0 8px 28px var(--sh)}
.lc.merge-selected{border-color:var(--ac);background:var(--ac-s)}
.lc-icon{font-size:1.4rem;margin-bottom:.5rem}
.lc-name{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--ac);margin-bottom:.25rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.lc-meta{font-size:.72rem;color:var(--ink-2);line-height:1.5}
.lc-pct{display:inline-block;font-size:.6rem;font-weight:700;padding:.12rem .45rem;border-radius:6px;margin-top:.35rem}
.lc-sr{font-size:.6rem;color:var(--ac2);font-family:'JetBrains Mono',monospace;margin-top:.2rem}
.lc-del{position:absolute;top:.65rem;right:.65rem;background:none;border:none;cursor:pointer;color:var(--ink-3);font-size:.75rem;padding:.2rem .35rem;border-radius:6px;transition:all .15s}
.lc-del:hover{background:#fee2e2;color:#dc2626}
.merge-cb{position:absolute;top:.65rem;left:.65rem;width:17px;height:17px;cursor:pointer;display:none}
.merging .merge-cb{display:block}
.merging .lc-del{display:none}

/* ══════════════ LOADING ══════════════ */
#screen-loading{align-items:center;justify-content:center;gap:1.6rem;padding:2rem}
.spinner{width:68px;height:68px;border:3px solid var(--br);border-top-color:var(--ac);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.ld-h{font-family:'Fraunces',serif;font-size:1.6rem;font-weight:500;text-align:center;color:var(--ink)}
.ld-s{color:var(--ink-2);font-size:.85rem;text-align:center}
.ld-steps{display:flex;flex-direction:column;gap:.6rem}
.ldstep{display:flex;align-items:center;gap:.75rem;font-size:.85rem;color:var(--ink-3);transition:color .4s;font-family:'JetBrains Mono',monospace;font-size:.72rem;letter-spacing:.03em}
.ldstep.active{color:var(--ac);font-weight:500}
.ldstep.done{color:var(--ac3)}
.ldstep-dot{width:7px;height:7px;border-radius:50%;background:currentColor;flex-shrink:0}

/* ══════════════ CARD VIEWER ══════════════ */
#screen-cards{overflow:hidden}
.cv-layout{flex:1;display:grid;grid-template-columns:240px 1fr;overflow:hidden;height:calc(100vh - 60px)}
@media(max-width:860px){.cv-layout{grid-template-columns:1fr;height:auto;overflow:visible}.sidebar{display:none!important}.sidebar.open{display:flex!important;position:fixed;inset:0;top:60px;z-index:40;overflow-y:auto}#screen-cards{overflow:visible}}
/* Sidebar */
.sidebar{background:var(--panel);border-right:1px solid var(--br);display:flex;flex-direction:column;overflow-y:auto;padding:.8rem;gap:.2rem}
.sbhd{font-size:.58rem;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:var(--ink-2);padding:.5rem .55rem .25rem}
.sb-info{font-family:'JetBrains Mono',monospace;font-size:.64rem;color:var(--ac);padding:.15rem .55rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sb-meta-t{font-size:.68rem;color:var(--ink-2);padding:.1rem .55rem .55rem}
.sbpill{border:none;background:transparent;border-radius:9px;padding:.5rem .75rem;font-size:.78rem;cursor:pointer;text-align:left;transition:all .15s;color:var(--ink-2);display:flex;align-items:center;justify-content:space-between;width:100%;gap:.4rem}
.sbpill:hover{background:var(--surf);color:var(--ink)}
.sbpill.active{background:var(--ac-s);color:var(--ac);font-weight:500;border:1px solid var(--br)}
.sb-cnt{font-family:'JetBrains Mono',monospace;font-size:.58rem;background:var(--surf);padding:.08rem .4rem;border-radius:8px;color:var(--ink-2);flex-shrink:0}
.sbpill.active .sb-cnt{background:var(--ac-s);color:var(--ac)}
/* Card area */
.card-area{display:flex;flex-direction:column;overflow-y:auto;padding:clamp(.8rem,3vw,1.5rem);gap:1rem;align-items:center}
@media(max-width:860px){.card-area{overflow:visible}}
.doc-banner{width:100%;max-width:760px;background:var(--panel);border:1px solid var(--br);border-radius:13px;padding:.8rem 1.1rem;display:flex;align-items:center;gap:.75rem;flex-shrink:0;flex-wrap:wrap}
.di{font-size:1.3rem}
.dn{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--ac)}
.dm{font-size:.68rem;color:var(--ink-2);margin-top:.12rem}
.etag{margin-left:auto;font-family:'JetBrains Mono',monospace;font-size:.58rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;padding:.2rem .65rem;border-radius:8px;background:var(--grad);color:#fff}
/* SR badge */
.sr-badge{margin-left:.3rem;font-family:'JetBrains Mono',monospace;font-size:.58rem;background:var(--ac2);color:#fff;padding:.12rem .45rem;border-radius:6px;vertical-align:middle}
/* Progress */
.prog-wrap{width:100%;max-width:760px;flex-shrink:0}
.prog-info{display:flex;justify-content:space-between;font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--ink-2);margin-bottom:.35rem}
.prog-track{height:3px;background:var(--br);border-radius:3px;overflow:hidden}
.prog-fill{height:100%;background:var(--grad);border-radius:3px;transition:width .5s cubic-bezier(.4,0,.2,1)}
/* THE CARD */
.card-scene{width:100%;max-width:760px;flex-shrink:0;aspect-ratio:16/9;min-height:230px;max-height:400px;perspective:1600px;cursor:pointer}
@media(max-width:500px){.card-scene{aspect-ratio:unset;height:270px}}
.card-inner{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .65s cubic-bezier(.4,0,.2,1)}
.card-scene.flipped .card-inner{transform:rotateY(180deg)}
.card-face{position:absolute;inset:0;backface-visibility:hidden;-webkit-backface-visibility:hidden;border-radius:22px;padding:clamp(1.2rem,3vw,2rem);display:flex;flex-direction:column;justify-content:center;overflow:hidden}
.card-front{background:var(--cf);color:#fff;box-shadow:0 20px 60px var(--sh)}
.card-front::before{content:'';position:absolute;top:-40px;right:-40px;width:160px;height:160px;border-radius:50%;background:rgba(255,255,255,.04)}
.card-front::after{content:'';position:absolute;bottom:-30px;left:-30px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.03)}
.card-back{background:var(--cb);transform:rotateY(180deg);border:1.5px solid var(--br);box-shadow:0 20px 60px var(--sh);color:var(--ink)}
.cchip{font-family:'JetBrains Mono',monospace;font-size:.56rem;letter-spacing:.14em;text-transform:uppercase;padding:.2rem .6rem;border-radius:100px;width:fit-content;margin-bottom:1rem;position:relative;z-index:1}
.card-front .cchip{background:rgba(255,255,255,.12);color:rgba(255,255,255,.65)}
.card-back .cchip{background:var(--ac-s);color:var(--ac);border:1px solid var(--br)}
.tbadge{position:absolute;top:.9rem;right:.9rem;font-family:'JetBrains Mono',monospace;font-size:.52rem;letter-spacing:.08em;text-transform:uppercase;padding:.14rem .48rem;border-radius:6px;z-index:2}
.card-front .tbadge{background:rgba(255,255,255,.1);color:rgba(255,255,255,.55)}
.card-back .tbadge{background:var(--surf);color:var(--ac2);border:1px solid var(--br)}
.priodot{position:absolute;top:.9rem;left:.9rem;width:8px;height:8px;border-radius:50%;z-index:2}
.card-q{font-family:'Fraunces',serif;font-size:clamp(.95rem,2.5vw,1.35rem);font-weight:500;line-height:1.45;position:relative;z-index:1;max-width:600px}
.card-a{font-size:clamp(.8rem,1.8vw,.92rem);line-height:1.8;font-weight:300;color:var(--ink);position:relative;z-index:1;max-width:620px;overflow-y:auto;max-height:210px}
.card-a strong{color:var(--ac);font-weight:600}
.card-a code{font-family:'JetBrains Mono',monospace;font-size:.8em;background:var(--surf);padding:.1em .35em;border-radius:4px;color:var(--ac2);border:1px solid var(--br)}
.flip-hint{position:absolute;bottom:.9rem;right:1.1rem;font-family:'JetBrains Mono',monospace;font-size:.52rem;letter-spacing:.06em;opacity:.28}
.card-front .flip-hint{color:#fff}
.card-back .flip-hint{color:var(--ink)}
/* SR Rating */
.sr-row{width:100%;max-width:760px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:.5rem;flex-shrink:0}
@media(max-width:500px){.sr-row{grid-template-columns:1fr 1fr}}
.sr-btn{border:none;border-radius:11px;padding:.7rem .5rem;font-family:'JetBrains Mono',monospace;font-size:.6rem;letter-spacing:.04em;cursor:pointer;transition:all .18s;font-weight:600;text-align:center;line-height:1.3}
.sr-again{background:#fee2e2;color:#991b1b}.sr-again:hover{background:#dc2626;color:#fff}
.sr-hard{background:#fef3c7;color:#92400e}.sr-hard:hover{background:#d97706;color:#fff}
.sr-good{background:#dcfce7;color:#166534}.sr-good:hover{background:#16a34a;color:#fff}
.sr-easy{background:#e0f2fe;color:#075985}.sr-easy:hover{background:#0369a1;color:#fff}
.sr-hint{font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--ink-3);text-align:center;letter-spacing:.03em}
/* Card controls */
.card-ctrls{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;justify-content:center;width:100%;max-width:760px;flex-shrink:0}
.ctrl{font-family:'JetBrains Mono',monospace;font-size:.68rem;letter-spacing:.04em;border-radius:11px;padding:.78rem 1.2rem;cursor:pointer;transition:all .18s;border:none;display:flex;align-items:center;gap:.35rem;touch-action:manipulation}
.ctrl-nav{background:var(--panel);color:var(--ink);border:1px solid var(--br)}
.ctrl-nav:hover:not(:disabled){background:var(--surf);border-color:var(--ac);color:var(--ac)}
.ctrl-nav:disabled{opacity:.28;cursor:not-allowed}
.ctrl-flip{background:var(--grad);color:#fff;padding:.78rem 1.8rem;font-size:.72rem}
.ctrl-flip:hover{opacity:.88;transform:translateY(-1px)}
.ctrl-act{background:var(--surf);color:var(--ink-2);border:1px solid var(--br)}
.ctrl-act:hover{border-color:var(--ac);color:var(--ac);background:var(--ac-s)}
.kb-row{font-family:'JetBrains Mono',monospace;font-size:.58rem;color:var(--ink-3);letter-spacing:.06em;display:flex;gap:.6rem;flex-wrap:wrap;justify-content:center}@media(pointer:coarse){.kb-row{display:none}}
.kb-row kbd{border:1px solid var(--br);border-radius:4px;padding:.08em .4em;background:var(--surf);font-family:inherit}
.sb-toggle{display:none;font-family:'JetBrains Mono',monospace;font-size:.62rem;border:1px solid var(--br);background:var(--panel);border-radius:9px;padding:.42rem .8rem;cursor:pointer;align-items:center;gap:.35rem;color:var(--ink-2);transition:all .18s}
@media(max-width:860px){.sb-toggle{display:flex}}
.sb-toggle:hover{color:var(--ac);border-color:var(--ac)}

/* ══════════════ EXPLAIN MODAL ══════════════ */
.modal-overlay{display:none;position:fixed;inset:0;z-index:100;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);align-items:flex-end;justify-content:center}
.modal-overlay.show{display:flex}
.explain-modal{background:var(--panel);border:1px solid var(--br);border-radius:24px 24px 0 0;padding:1.8rem;width:100%;max-width:800px;max-height:75vh;overflow-y:auto;box-shadow:0 -16px 60px var(--sh);animation:slideUp .35s ease both}
@keyframes slideUp{from{transform:translateY(40px);opacity:0}to{transform:translateY(0);opacity:1}}
.explain-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.2rem}
.explain-title{font-family:'Fraunces',serif;font-size:1.2rem;font-weight:500;display:flex;align-items:center;gap:.5rem}
.explain-close{background:var(--surf);border:1px solid var(--br);border-radius:9px;padding:.4rem .7rem;cursor:pointer;font-size:.8rem;color:var(--ink-2);transition:all .18s}
.explain-close:hover{color:var(--ac);border-color:var(--ac)}
.explain-body{font-size:.88rem;line-height:1.85;color:var(--ink-2)}
.explain-body strong{color:var(--ink);font-weight:600}
.explain-body code{font-family:'JetBrains Mono',monospace;font-size:.8em;background:var(--surf);padding:.1em .4em;border-radius:4px;color:var(--ac2);border:1px solid var(--br)}
.explain-loading{display:flex;align-items:center;gap:.75rem;color:var(--ink-2);font-size:.85rem;padding:1rem 0}
.explain-spinner{width:20px;height:20px;border:2.5px solid var(--br);border-top-color:var(--ac);border-radius:50%;animation:spin .7s linear infinite;flex-shrink:0}

/* ══════════════ DASHBOARD ══════════════ */
.dash-wrap{flex:1;padding:clamp(1.5rem,4vw,2.5rem) clamp(1rem,4vw,2rem);max-width:1100px;margin:0 auto;width:100%;display:flex;flex-direction:column;gap:1.8rem}
.dash-ttl{font-family:'Fraunces',serif;font-size:2rem;font-weight:500;letter-spacing:-.02em;color:var(--ink)}
.dash-ttl span{background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.dash-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:1.3rem}
.dc{background:var(--panel);border:1px solid var(--br);border-radius:20px;padding:1.4rem;box-shadow:0 4px 20px var(--sh)}
.dc h3{font-family:'Fraunces',serif;font-size:1rem;font-weight:500;margin-bottom:1rem;display:flex;align-items:center;gap:.45rem;color:var(--ink)}
.stat-row{display:flex;gap:.8rem;flex-wrap:wrap}
.sbox{flex:1;min-width:80px;background:var(--surf);border-radius:11px;padding:.9rem;text-align:center;border:1px solid var(--br)}
.snum{font-family:'Fraunces',serif;font-size:1.8rem;font-weight:700;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1}
.slbl{font-size:.67rem;color:var(--ink-2);margin-top:.25rem;font-family:'JetBrains Mono',monospace;letter-spacing:.04em}
/* Streak */
.streak-disp{display:flex;align-items:center;gap:1rem;margin-bottom:.8rem}
.sf{font-size:3rem;line-height:1}
.sn{font-family:'Fraunces',serif;font-size:2.4rem;font-weight:700;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1}
.ss{font-size:.78rem;color:var(--ink-2);font-family:'JetBrains Mono',monospace}
.scal{display:flex;gap:.35rem;flex-wrap:wrap}
.sday{width:26px;height:26px;border-radius:7px;background:var(--surf);border:1px solid var(--br);display:flex;align-items:center;justify-content:center;font-size:.58rem;font-family:'JetBrains Mono',monospace;color:var(--ink-3)}
.sday.studied{background:var(--grad);color:#fff;border-color:transparent}
.sday.today{border-color:var(--ac);border-width:2px}
/* Badges */
.badges-g{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:.7rem}
.badge-it{background:var(--surf);border-radius:12px;padding:.7rem;text-align:center;border:1.5px solid var(--br);transition:all .2s;cursor:default}
.badge-it.earned{border-color:var(--ac);background:var(--ac-s);box-shadow:0 0 16px var(--sh)}
.badge-it.locked{opacity:.3;filter:grayscale(1)}
.be{font-size:1.7rem;display:block;margin-bottom:.35rem}
.bn{font-size:.6rem;font-weight:600;color:var(--ink-2);line-height:1.3;font-family:'JetBrains Mono',monospace}
.badge-it.earned .bn{color:var(--ac)}
/* Mastery */
.chart-wrap{position:relative;height:200px}
.mtable{width:100%;border-collapse:collapse;font-size:.8rem;margin-top:.8rem}
.mtable th{text-align:left;font-family:'JetBrains Mono',monospace;font-size:.6rem;letter-spacing:.08em;text-transform:uppercase;color:var(--ink-2);padding:.45rem .7rem;border-bottom:1px solid var(--br)}
.mtable td{padding:.55rem .7rem;border-bottom:1px solid var(--br)}
.mbar-w{display:inline-block;width:65px;height:6px;background:var(--br);border-radius:3px;overflow:hidden;vertical-align:middle;margin-left:.45rem}
.mbar{height:100%;border-radius:3px;background:var(--grad)}
/* Weak spots */
.weak-list{display:flex;flex-direction:column;gap:.6rem}
.weak-item{display:flex;align-items:center;justify-content:space-between;background:var(--surf);border-radius:11px;padding:.75rem 1rem;border:1px solid var(--br);gap:.5rem;flex-wrap:wrap}
.wi-topic{font-size:.82rem;font-weight:500;color:var(--ink);flex:1;min-width:100px}
.wi-pct{font-family:'JetBrains Mono',monospace;font-size:.7rem;color:#ef4444;font-weight:600;white-space:nowrap}
.wi-btn{border:none;background:var(--ac-s);color:var(--ac);border-radius:8px;padding:.4rem .75rem;font-size:.65rem;font-family:'JetBrains Mono',monospace;cursor:pointer;white-space:nowrap;border:1px solid var(--br);transition:all .18s;font-weight:500}
.wi-btn:hover{background:var(--ac);color:#fff;border-color:var(--ac)}
/* NCERT chapters */
.chapter-tags{display:flex;flex-wrap:wrap;gap:.4rem}
.ch-tag{font-family:'JetBrains Mono',monospace;font-size:.62rem;background:var(--surf);border:1px solid var(--br);border-radius:8px;padding:.25rem .6rem;color:var(--ink-2);cursor:pointer;transition:all .18s}
.ch-tag:hover{border-color:var(--ac);color:var(--ac)}
.ch-tag.active{background:var(--ac-s);border-color:var(--ac);color:var(--ac)}

/* ══════════════ TOAST ══════════════ */
.toast{position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%);padding:.7rem 1.3rem;border-radius:12px;font-size:.78rem;font-family:'JetBrains Mono',monospace;box-shadow:0 8px 32px rgba(0,0,0,.25);z-index:200;display:none;max-width:90vw;text-align:center;white-space:nowrap;letter-spacing:.03em;border:1px solid transparent}
.toast.success{background:#166534;color:#dcfce7;border-color:#16a34a}
.toast.error{background:#991b1b;color:#fee2e2;border-color:#dc2626}
.toast.info{background:var(--panel);color:var(--ac);border-color:var(--br)}

/* ══════════════ OFFLINE BANNER ══════════════ */
.offline-banner{display:none;background:#7f1d1d;color:#fca5a5;padding:.5rem 1.5rem;text-align:center;font-family:'JetBrains Mono',monospace;font-size:.72rem;letter-spacing:.04em;border-bottom:1px solid #991b1b}
.offline-banner.show{display:block}

/* ══════════════ ANIMATIONS ══════════════ */
@keyframes cardSwap{0%{opacity:1;transform:scale(1)}45%{opacity:0;transform:scale(.95) translateY(6px)}100%{opacity:1;transform:scale(1)}}
.card-scene.swap{animation:cardSwap .32s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.fin{animation:fadeUp .55s ease both}
@keyframes pop{0%{transform:scale(1)}55%{transform:scale(1.22)}100%{transform:scale(1)}}
.pop{animation:pop .32s ease}
@keyframes celebrate{0%,100%{transform:rotate(0deg)}25%{transform:rotate(-10deg)}75%{transform:rotate(10deg)}}
.celebrate{animation:celebrate .5s ease}

/* ══════════════ TABLET OPTIMISATION ══════════════ */
button, .nb, .ctrl, .cc, .tab, .sw, .sbpill, .rate-btn, .sr-btn, .qopt, .lc, .wi-btn, .date-row button {
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

@media (min-width: 768px) {
  .nav { height: 68px; padding: 0 clamp(1.2rem,4vw,2.5rem); }
  .nav-brand { font-size: 1.6rem; }
  .nb { font-size: .72rem; padding: .55rem 1rem; border-radius: 11px; }
  .sw { width: 26px; height: 26px; }
  .upload-grid { gap: 2.5rem; padding: 2.5rem clamp(1.5rem,4vw,3rem); max-width: 1200px; }
  .hero h1 { font-size: clamp(2.2rem,4.5vw,3.4rem); }
  .hero p { font-size: 1rem; max-width: 480px; }
  .fc { font-size: .82rem; padding: .35rem .9rem; }
  .panel { padding: 2rem; border-radius: 24px; }
  .cc { padding: .7rem 1.1rem; font-size: 1.05rem; border-radius: 12px; }
  .tab { padding: .6rem; font-size: .75rem; }
  .lib-grid { grid-template-columns: repeat(auto-fill, minmax(210px, 1fr)); gap: 1.1rem; }
  .lc { padding: 1.3rem; border-radius: 16px; }
  .lc-icon { font-size: 1.7rem; }
  .lc-name { font-size: .75rem; }
  .lc-meta { font-size: .78rem; }
  .cv-layout { grid-template-columns: 270px 1fr; }
  .sidebar { padding: 1.1rem; }
  .sbpill { padding: .65rem .9rem; font-size: .85rem; border-radius: 11px; }
  .card-scene { max-height: 440px; border-radius: 26px; }
  .card-face { padding: 2.2rem 2.5rem; border-radius: 26px; }
  .card-q { font-size: clamp(1.1rem, 2.2vw, 1.5rem); line-height: 1.42; }
  .card-a { font-size: clamp(.88rem, 1.6vw, 1rem); line-height: 1.82; max-height: 240px; }
  .cchip { font-size: .65rem; padding: .25rem .75rem; margin-bottom: 1.4rem; }
  .tbadge { font-size: .6rem; top: 1.1rem; right: 1.1rem; }
  .priodot { top: 1.1rem; left: 1.1rem; width: 10px; height: 10px; }
  .sr-row { grid-template-columns: 1fr 1fr 1fr 1fr; gap: .7rem; max-width: 760px; }
  .sr-btn { padding: .9rem .7rem; font-size: .7rem; border-radius: 13px; }
  .card-ctrls { gap: .75rem; }
  .ctrl { padding: .95rem 1.5rem; font-size: .78rem; border-radius: 13px; }
  .ctrl-flip { padding: .95rem 2.2rem; font-size: .82rem; }
  .prog-track { height: 5px; border-radius: 5px; }
  .prog-info { font-size: .72rem; }
  .doc-banner { padding: 1rem 1.3rem; border-radius: 15px; }
  .dn { font-size: .78rem; }
  .dm { font-size: .74rem; }
  .dash-grid { gap: 1.6rem; }
  .dc { padding: 1.6rem; border-radius: 22px; }
  .snum { font-size: 2rem; }
  .sn { font-size: 2.6rem; }
  .explain-modal { border-radius: 28px 28px 0 0; padding: 2.2rem; }
  .explain-body { font-size: .92rem; line-height: 1.9; }
}

@media (min-width: 1024px) {
  .nav { height: 70px; }
  .cv-layout { grid-template-columns: 290px 1fr; height: calc(100vh - 70px); }
  .card-scene { max-height: 460px; }
  .card-q { font-size: clamp(1.15rem, 1.9vw, 1.55rem); }
  .ctrl { padding: 1rem 1.6rem; font-size: .8rem; }
  .ctrl-flip { padding: 1rem 2.4rem; }
  .sr-btn { padding: 1rem .9rem; font-size: .72rem; }
  .upload-grid { max-width: 1300px; }
}

@media (min-width: 768px) and (max-width: 1023px) and (orientation: portrait) {
  .upload-grid { grid-template-columns: 1fr; max-width: 640px; }
  .cv-layout { grid-template-columns: 1fr; }
  .sidebar { display: none !important; }
  .sidebar.open { display: flex !important; position: fixed; inset: 0; top: 68px; z-index: 40; overflow-y: auto; max-width: 320px; box-shadow: 4px 0 40px var(--sh); }
  .sb-toggle { display: flex !important; }
  .card-scene { max-height: 380px; }
  .sr-row { grid-template-columns: 1fr 1fr; }
}

.nb, .ctrl, .cc, .sr-btn, .tab { min-height: 48px; }
.sbpill { min-height: 44px; }
.sw { min-width: 28px; min-height: 28px; }

@media (min-width: 768px) {
  .card-area { padding: 1.5rem 2rem; gap: 1.3rem; }
  .prog-wrap { max-width: 800px; }
  .card-scene { max-width: 800px; }
  .sr-row { max-width: 800px; }
  .card-ctrls { max-width: 800px; }
  .doc-banner { max-width: 800px; }
  .kb-row { font-size: .65rem; gap: .8rem; }
}

.swipe-indicator { display: none; }
@media (min-width: 768px) and (pointer: coarse) {
  .swipe-indicator {
    display: flex;
    align-items: center;
    gap: .5rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: .6rem;
    color: var(--ink-3);
    letter-spacing: .06em;
    justify-content: center;
  }
}
